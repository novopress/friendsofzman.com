{{ define "main" }}
<main>
  <article>
    <div class="post-container">
      <!-- Main Content -->
      <div class="content">
        <div class="title">
          <header>
            <h2 class="title">{{ .Title }}</h2>
            <p class="text-center">
              <dl class="post-meta">
                <dt>Date:</dt>
                <dd>
                  <time datetime="{{ .Date.Format "2006-01-02" }}">
                    {{ .Date.Format "January 2, 2006" }}
                  </time>
                </dd>

                {{ with .Params.categories }}
                  <dt>Categories:</dt>
                  <dd>
                    {{ range $i, $cat := . }}
                      {{ if $i }}, {{ end }}
                      <a href="{{ "/categories/" | relURL }}{{ $cat | urlize }}">{{ $cat }}</a>
                    {{ end }}
                  </dd>
                {{ end }}

                {{ if .Params.original_url }}
                  <dt>Canonical:</dt>
                  <dd>
                    {{ $slug := .Params.original_slug | default .Params.original_url }}
                    {{ $cleanSlug := ($slug | replaceRE "\\?p=(\\d+).*" "$1") | default "Original Post" }}
                    <a href="{{ .Params.original_url }}">#{{ $cleanSlug }}</a>
                  </dd>
                  <dt>Archive:</dt>
                  <dd>
                    <a href="https://web.archive.org/web/{{ .Params.original_url }}">#{{ $cleanSlug }}</a>
                    [<a href="https://web.archive.org/web/*/{{ .Params.original_url}}">history</a>]
                  </dd>
                {{ end }}
              </dl>
            </p>
          </header>
        </div>
        {{ if isset .Params "tldr" }}
        <div class="tldr">
          <strong>tl;dr:</strong>
          {{ .Params.tldr }}
        </div>{{ end }}
        <section class="body">
          {{ .Content }}
        </section>
        <div class="post-tags">
          {{ if ne .Type "page" }}
          {{ if gt .Params.tags 0 }}
          <nav class="nav tags">
            <ul class="tags">
              {{ range .Params.tags }}
              <li><a href="{{ "/tags/" | relLangURL }}{{ . | urlize }}">{{ . }}</a></li>
              {{ end }}
            </ul>
          </nav>
          {{ end }}
          {{ end }}
        </div>
      </div>

      <!-- TOC -->
      {{ if isset .Params "toc" }}
      <div class="toc">
        <strong>Table of contents:</strong>
        {{ .TableOfContents }}
      </div>
      {{ end }}
    </div>

    <!-- Disqus -->
    {{- $.Scratch.Set "isDisqus" true -}}
    {{ if not .Site.Config.Services.Disqus.Shortname }}
    {{- $.Scratch.Set "isDisqus" false -}}
    {{ end }}

    {{- if eq ($.Scratch.Get "isDisqus") true -}}
    {{- partial "disqus.html" . -}}
    {{- end -}}
  </article>
</main>
{{ end }}
